<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ResumeBuilder — Signup / Login</title>

  <style>
    :root{
      --accent-start:#34d399; --accent-end:#059669;
      --bg-a:#e7fff6; --bg-b:#e7ebff;
      --text:#06202a;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
    body{
      display:flex; align-items:center; justify-content:center; padding:28px;
      background: linear-gradient(120deg,var(--bg-a), var(--bg-b));
    }
    .container{ width:100%; max-width:1100px; min-height:520px; border-radius:14px; overflow:hidden;
      display:grid; grid-template-columns: 1fr 480px; box-shadow: 0 20px 50px rgba(10,20,30,0.12); }
    .visual{ padding:36px; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.45), rgba(255,255,255,0.28)); }
    .brand{ position:absolute; left:28px; top:24px; display:flex; gap:10px; align-items:center; font-weight:700; color:var(--text); }
    .brand .square{ width:34px; height:34px; border-radius:8px; background:linear-gradient(180deg,var(--accent-start),var(--accent-end)); }
    .illustration{ width:78%; max-width:540px; height:auto; filter: drop-shadow(0 18px 40px rgba(8,20,30,0.12)); }
    .card{ padding:34px; background: linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.88)); color:var(--text); display:flex; flex-direction:column; gap:12px; box-sizing:border-box; }
    h1{ margin:0; font-size:26px; color:#05323a; font-weight:700; }
    p.lead{ margin:0;color:#234048; opacity:0.8; font-size:14px }
    label{display:block;font-size:13px;color:#125257;margin-bottom:6px;font-weight:600}
    .field{ display:block; margin-bottom:12px }
    input[type="text"], input[type="email"], input[type="password"]{
      width:100%; padding:12px 14px; border-radius:10px; border:1px solid rgba(6,32,35,0.06);
      background: rgba(6,32,35,0.03); color:#05323a; font-size:15px; box-sizing:border-box; outline: none;
    }
    input::placeholder{ color: #8aa5a0; opacity:0.9 }
    .actions{ display:flex; gap:12px; margin-top:8px; align-items:center }
    .btn { flex:1; padding:12px 14px; border-radius:10px; border:0; font-weight:700; cursor:pointer; color:white;
          background: linear-gradient(180deg,var(--accent-start),var(--accent-end)); box-shadow: 0 8px 24px rgba(5,150,105,0.12); }
    .btn.secondary{ background: transparent; color: #0b2c2a; border:1px solid rgba(3,20,18,0.06); font-weight:600; }
    .tiny{ font-size:13px; color: #295957; margin-top:6px }
    .link{ color: #0b5b4e; text-decoration:underline; cursor:pointer; font-weight:700 }
    @media (max-width:920px){
      .container{ grid-template-columns: 1fr; max-width:760px; min-height:640px; gap:18px; }
      .visual{ order:1; padding:20px; min-height:260px }
      .card{ order:2; padding:20px }
      .illustration{ width:56% }
    }
    #status { min-height:18px; font-size:14px; margin-top:6px; }
    .status-ok { color:#036a4a; }
    .status-err { color:#cc2b2b; }
  </style>

  <!-- supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
</head>
<body>
<div class="container" role="main" aria-label="Signup form">
  <div class="visual" aria-hidden="false">
    <div class="brand" aria-hidden="true">
      <div class="square" aria-hidden="true"></div>
      <div>ResumeLab</div>
    </div>

    <!-- Inline SVG illustration so page never breaks -->
    <svg class="illustration" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Desk illustration">
      <defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#a8ffdf"/><stop offset="1" stop-color="#d9e0ff"/></linearGradient>
      <linearGradient id="g2" x1="0" x2="1"><stop offset="0" stop-color="#60a5fa"/><stop offset="1" stop-color="#7c3aed"/></linearGradient></defs>
      <rect rx="24" width="800" height="500" fill="url(#g1)"/>
      <g transform="translate(60,40)"><rect x="90" y="120" width="420" height="220" rx="14" fill="#fff" opacity="0.95" />
      <rect x="130" y="40" width="340" height="160" rx="10" fill="url(#g2)" />
      <rect x="240" y="20" width="100" height="10" rx="5" fill="#fff" opacity="0.6"/>
      <rect x="120" y="320" width="240" height="18" rx="6" fill="#7c8a95" opacity="0.25"/>
      <circle cx="400" cy="360" r="42" fill="#e6f9f0" opacity="0.9"/></g>
    </svg>
  </div>

  <div class="card" role="form" aria-labelledby="signup-title">
    <!-- Signup -->
    <div id="signupSection">
      <h1 id="signup-title">Create an account</h1>
      <p class="lead">Join ResumeLab — save profiles and generate tailored resumes with AI.</p>

      <div class="field"><label for="su-fullName">Full name</label><input id="su-fullName" type="text" placeholder="Your full name" autocomplete="name" /></div>
      <div class="field"><label for="su-email">Email</label><input id="su-email" type="email" placeholder="you@domain.com" autocomplete="email" /></div>
      <div class="field"><label for="su-password">Password</label><input id="su-password" type="password" placeholder="Choose a password (min 6 chars)" autocomplete="new-password" /></div>
      <div class="field"><label for="su-password2">Confirm password</label><input id="su-password2" type="password" placeholder="Repeat password" autocomplete="new-password" /></div>

      <div class="actions">
        <button id="btnSignup" class="btn">Sign Up</button>
        <button id="btnGotoLogin" class="btn secondary">Log in</button>
      </div>

      <div id="status" aria-live="polite"></div>

      <div class="tiny">By signing up you agree to our <span class="link">Terms</span>. Already have an account?
        <span id="linkLogin" class="link">Log in</span>
      </div>
    </div>

    <!-- Login (hidden) -->
    <div id="loginSection" style="display:none;">
      <h1>Welcome back</h1>
      <p class="lead">Log in to your ResumeLab account</p>

      <div class="field"><label for="li-email">Email</label><input id="li-email" type="email" placeholder="you@domain.com" autocomplete="email" /></div>
      <div class="field"><label for="li-password">Password</label><input id="li-password" type="password" placeholder="Password" autocomplete="current-password" /></div>

      <div class="actions">
        <button id="btnLogin" class="btn">Log In</button>
        <button id="btnGotoSignup" class="btn secondary">Create account</button>
      </div>

      <div id="statusLogin" aria-live="polite" style="min-height:18px;margin-top:8px;"></div>
    </div>

  </div>
</div>

<script>
/* ========== CONFIG: replace with your project values if different ========== */
const SUPABASE_URL = 'https://aisuwbgwhvbikdvoming.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_OZ2XcYvyUC3cpTUPUXhTig_bH_U1QO7';
const REDIRECT_AFTER_LOGIN = 'home.html';
/* ======================================================================== */

const { createClient } = supabase;
const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const signupSection = document.getElementById('signupSection');
const loginSection = document.getElementById('loginSection');
const status = document.getElementById('status');
const statusLogin = document.getElementById('statusLogin');

function showSignup(){ loginSection.style.display='none'; signupSection.style.display='block'; status.textContent=''; statusLogin.textContent=''; document.getElementById('su-fullName').focus(); }
function showLogin(){ signupSection.style.display='none'; loginSection.style.display='block'; status.textContent=''; statusLogin.textContent=''; document.getElementById('li-email').value = document.getElementById('su-email').value || ''; document.getElementById('li-email').focus(); }

document.getElementById('linkLogin').addEventListener('click', showLogin);
document.getElementById('btnGotoLogin').addEventListener('click', showLogin);
document.getElementById('btnGotoSignup').addEventListener('click', showSignup);

// helper
function setDisabled(el, v){ if(!el) return; el.disabled = v; }

// Signup flow
document.getElementById('btnSignup').addEventListener('click', async () => {
  const fullName = document.getElementById('su-fullName').value.trim();
  const email = document.getElementById('su-email').value.trim();
  const password = document.getElementById('su-password').value;
  const password2 = document.getElementById('su-password2').value;

  if(!fullName || !email || !password){ status.className='status-err'; status.textContent = 'Please fill name, email and password.'; return; }
  if(password.length < 6){ status.className='status-err'; status.textContent = 'Password must be at least 6 characters.'; return; }
  if(password !== password2){ status.className='status-err'; status.textContent = 'Passwords do not match.'; return; }

  status.className=''; status.textContent='Signing up…';
  setDisabled(document.getElementById('btnSignup'), true);
  try{
    const { data, error } = await supabaseClient.auth.signUp({ email, password });
    if(error){ status.className='status-err'; status.textContent = 'Signup error: ' + error.message; setDisabled(document.getElementById('btnSignup'), false); return; }

    const user = data?.user || null;
    if(user && user.id){
      // create profile row immediately
      const { error: upserr } = await supabaseClient.from('profiles').upsert({ id: user.id, full_name: fullName, created_at: new Date() }, { returning:'minimal' });
      if(upserr){ status.className='status-err'; status.textContent = 'Signed up, but failed to create profile: ' + upserr.message; }
      else { status.className='status-ok'; status.textContent = 'Signed up — redirecting...'; setTimeout(()=> window.location.href = REDIRECT_AFTER_LOGIN, 900); }
    } else {
      status.className='status-ok'; status.textContent = 'Signup successful — check your email to confirm (if required), then log in.';
      setTimeout(showLogin, 700);
    }
  } catch(e){ console.error(e); status.className='status-err'; status.textContent = 'Unexpected: ' + (e.message || e); }
  finally{ setDisabled(document.getElementById('btnSignup'), false); }
});

// Login flow
document.getElementById('btnLogin').addEventListener('click', async () => {
  const email = document.getElementById('li-email').value.trim();
  const password = document.getElementById('li-password').value;
  if(!email || !password){ statusLogin.className='status-err'; statusLogin.textContent='Enter email and password'; return; }

  statusLogin.className=''; statusLogin.textContent='Logging in...';
  setDisabled(document.getElementById('btnLogin'), true);
  try{
    const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
    if(error){ statusLogin.className='status-err'; statusLogin.textContent = 'Login error: ' + error.message; setDisabled(document.getElementById('btnLogin'), false); return; }
    statusLogin.className='status-ok'; statusLogin.textContent='Logged in — redirecting...';
    setTimeout(()=> window.location.href = REDIRECT_AFTER_LOGIN, 700);
  } catch(e){ console.error(e); statusLogin.className='status-err'; statusLogin.textContent='Unexpected: ' + (e.message || e); }
  finally{ setDisabled(document.getElementById('btnLogin'), false); }
});

// If already logged in, redirect
(async function(){
  const { data } = await supabaseClient.auth.getUser();
  if(data?.user) window.location.href = REDIRECT_AFTER_LOGIN;
})();
</script>
</body>
</html>
