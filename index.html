<!-- signup.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Resume Builder — Signup</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="common.js"></script>
  <style>
    :root{
      --grad-a:#0f3b38;
      --grad-b:#12c6b0;
      --card:#0f3734;
      --muted:rgba(255,255,255,0.85);
    }
    html,body{height:100%;margin:0;font-family:Inter, Arial, Helvetica, sans-serif;background:linear-gradient(120deg,var(--grad-a),var(--grad-b));}
    .center-wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:36px}
    .card{width:900px;max-width:94%;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));border-radius:12px;box-shadow:0 30px 50px rgba(0,0,0,0.35);padding:36px;display:flex;gap:28px;color:#fff}
    .left{flex:1;display:flex;flex-direction:column;align-items:flex-start;gap:18px}
    .logo{display:flex;gap:12px;align-items:center}
    .logo .badge{width:34px;height:34px;border-radius:8px;background:linear-gradient(180deg,#18d6bd,#0fb79a)}
    h1{font-size:40px;margin:0 0 6px 0; font-weight:800}
    .subtitle{color:rgba(255,255,255,0.85);font-size:14px;margin-bottom:6px}
    .illustration{flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));border-radius:8px;min-height:220px;display:flex;align-items:center;justify-content:center}
    .illustration .box{width:60%;height:60%;background:rgba(255,255,255,0.85);border-radius:6px;opacity:0.95}
    .right{width:420px;min-width:280px}
    label{font-size:12px;display:block;margin:10px 0 6px;color:rgba(255,255,255,0.85);letter-spacing:0.6px}
    input[type="text"], input[type="email"], input[type="password"]{
      width:100%;padding:12px 16px;border-radius:28px;border:none;background:rgba(255,255,255,0.95);color:#063; font-weight:600;box-shadow: inset 0 1px 0 rgba(0,0,0,0.02);
    }
    .btn{
      display:inline-block;margin-top:18px;padding:14px 28px;border-radius:10px;background:linear-gradient(180deg,#15d1b9,#06b89c);color:#012;font-weight:800;cursor:pointer;border:0;box-shadow:0 10px 18px rgba(2,46,41,0.2)
    }
    .link-row{margin-top:12px;font-size:14px}
    .link-row a{color:#fff;font-weight:700;text-decoration:underline}
    .status{height:20px;margin-top:8px}
    @media(max-width:880px){ .card{flex-direction:column} .right{width:100%} }
  </style>
</head>
<body>
  <div class="center-wrap">
    <div class="card">
      <div class="left">
        <div class="logo">
          <div class="badge"></div>
          <div style="font-weight:700">ResumeLab</div>
        </div>
        <h1>Create a New Account</h1>
        <div class="subtitle">Join ResumeLab — save profiles, generate tailored resumes with AI.</div>
        <div class="illustration">
          <div class="box"></div>
        </div>
        <div style="font-size:13px;color:rgba(255,255,255,0.75);margin-top:8px">By signing up you agree to our <u>Terms</u>.</div>
      </div>

      <div class="right">
        <label>Full name</label>
        <input id="su-name" type="text" placeholder="Your full name" />

        <label>Email</label>
        <input id="su-email" type="email" placeholder="you@domain.com" />

        <label>Password</label>
        <input id="su-pass" type="password" placeholder="Choose a password" />

        <label>Confirm password</label>
        <input id="su-pass2" type="password" placeholder="Confirm password" />

        <button id="btn-signup" class="btn">Sign Up</button>

        <div class="link-row">Already have an account? <a href="login.html">Log in</a></div>
        <div id="status" class="status"></div>
      </div>
    </div>
  </div>

<script>
  appCommon.initSupabase();
  const supabase = appCommon.supabaseClientRef();

  document.getElementById('btn-signup').addEventListener('click', async () => {
    const name = document.getElementById('su-name').value.trim()
    const email = document.getElementById('su-email').value.trim()
    const pass = document.getElementById('su-pass').value
    const pass2 = document.getElementById('su-pass2').value
    const statusEl = document.getElementById('status')
    if(!email || !pass){ appCommon.showStatus(statusEl, 'Email & password required', false); return }
    if(pass.length < 6){ appCommon.showStatus(statusEl, 'Password must be >= 6 chars', false); return }
    if(pass !== pass2){ appCommon.showStatus(statusEl, 'Passwords do not match', false); return }
    appCommon.showStatus(statusEl, 'Signing up...')
    try{
      const { data, error } = await appCommon.supabaseClientRef().auth.signUp({ email, password: pass })
      if(error) { appCommon.showStatus(statusEl, 'Error: '+error.message, false); return }
      // create a minimal profile row (optional) - it's okay if table doesn't exist
      try{
        await appCommon.supabaseClientRef().from('profiles').upsert({ id: data.user?.id, full_name: name, phone: null, location: null, linkedin: null, github: null }, { returning: 'minimal' })
      }catch(e){}
      appCommon.showStatus(statusEl, 'Signup succeeded — check email for confirmation (if required).')
      // optionally redirect to login
      setTimeout(()=> window.location.href = 'login.html', 1400)
    }catch(e){
      appCommon.showStatus(statusEl, 'Error signing up', false)
    }
  })
</script>
</body>
</html>
