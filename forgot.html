<!-- After UMD + common.js -->
<script src="common.js"></script>
<script>
  (function(){
    const btn = document.getElementById('btn-send') || document.querySelector('[data-reset]');
    if (!btn) return console.warn('Reset button not found');

    btn.addEventListener('click', async (e) => {
      e.preventDefault();
      const email = (document.getElementById('fg-email')||{}).value || (document.querySelector('[name="email"]')||{}).value;
      if (!email) return alert('Enter email');
      btn.disabled = true;
      btn.innerText = 'Sending...';

      const redirectTo = window.location.origin + '/login.html';
      const { data, error } = await Common.resetPasswordForEmail(email, redirectTo);
      btn.disabled = false;
      btn.innerText = 'Send';
      if (error) return alert('Reset error: ' + error.message);
      alert('If that account exists, a reset email has been sent.');
      window.location.href = 'login.html';
    });
  })();
</script>
